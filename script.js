var precios={};document.addEventListener("DOMContentLoaded",function(){var mostrarCargando=function mostrarCargando(){precioTotalElement.innerText="Cargando datos..."};var ocultarCargando=function ocultarCargando(){precioTotalElement.innerText=""};var calcularPrecio=function calcularPrecio(){mostrarCargando();var cantidadPersonas=parseInt(cantidadPersonasInput.value);var precioTotal=0;checkboxes.forEach(function(checkbox){if(checkbox.checked){var elemento=checkbox.id;var precioElemento=precios[elemento]?precios[elemento].precio:0;var cantidadSeleccionada=obtenerCantidadSeleccionada(elemento,cantidadPersonas);precioTotal+=cantidadSeleccionada*precioElemento;mostrarPrecioEnHTML(elemento,precioElemento)}});precioTotalElement.innerText="$"+precioTotal.toFixed(2);ocultarCargando()};var obtenerCantidadSeleccionada=function obtenerCantidadSeleccionada(elemento,cantidadPersonas){var maximo=precios[elemento]?precios[elemento].maximo:0;if(elemento.includes("plato")){return Math.min(cantidadPersonas,maximo)}else{var cantidadPersonalizadaInput=document.getElementById("cantidad_".concat(elemento));var cantidadPersonalizada=cantidadPersonalizadaInput?parseInt(cantidadPersonalizadaInput.value):0;cantidadPersonalizada=cantidadPersonalizada>0?cantidadPersonalizada:cantidadPersonas;return Math.min(cantidadPersonalizada,maximo)}};var mostrarPrecioEnHTML=function mostrarPrecioEnHTML(elemento,precioElemento){var precioElement=document.getElementById("precio_".concat(elemento));if(precioElement){precioElement.textContent="$".concat(precioElemento.toFixed(2))}else{console.error("Elemento de precio no encontrado: ".concat(elemento))}};var obtenerDatos=function obtenerDatos(){mostrarCargando();fetch("https://api.jsonbin.io/v3/b/".concat(binId,"/latest")).then(function(response){return response.json()}).then(function(data){precios=data.record;ocultarCargando();calcularPrecio()}).catch(function(error){console.error("Error al obtener los datos:",error);ocultarCargando()})};var apiKey="$2a$10$n3Be/OiZpAJ7KI5vUYT6dOmj90s0tg2/5T3QHbVdDbTBTxTiKc62K";var binId="655f87a254105e766fd41d19";var checkboxes=document.querySelectorAll(".container-checkboxs input[type=checkbox]");var cantidadPersonasInput=document.getElementById("bedrooms-input");var precioTotalElement=document.getElementById("precioFinal");var actualizarButton=document.getElementById("actualizar-button");var firmaContainer=document.getElementById("firma-container");var canvas=document.createElement("canvas");firmaContainer.appendChild(canvas);var firmaPad=new SignaturePad(canvas);document.getElementById("borrar-firma").addEventListener("click",function(){event.preventDefault();firmaPad.clear()});actualizarButton.addEventListener("click",function(){obtenerDatos()});calcularPrecio()});var jsPDF=window.jspdf.jsPDF;var pdf;document.getElementById("descargarPDF").addEventListener("click",function(){descargarPDF()});function descargarPDF(){var pdf=new window.jspdf.jsPDF;var cantidadPersonas=document.getElementById("bedrooms-input").value.trim();var vajillasSeleccionadas=[];var precioTotal=0;var checkboxes=document.querySelectorAll('.container-checkboxs input[type="checkbox"]');var maximo;// Definir maximo aquí
checkboxes.forEach(function(checkbox){if(checkbox.checked){var id=checkbox.id;var valor=checkbox.value;var precioElement=document.getElementById("precio_"+id);var precio=precioElement?parseFloat(precioElement.textContent.trim().replace("$","")):0;var cantidadElement=document.getElementById("cantidad_"+id);var cantidad=cantidadElement?parseInt(cantidadElement.value.trim()):0;if(isNaN(precio)){precio=0}if(id.includes("plato")){maximo=precios[id]?parseFloat(precios[id].maximo):0;// Definir maximo aquí
cantidad=Math.min(parseInt(cantidadPersonas),maximo)}else if(id.includes("cuchillos")||id.includes("tenedor_mesa")||id.includes("cuchara_postre")||id.includes("copa")){maximo=precios[id]?parseFloat(precios[id].maximo):0;cantidad=Math.min(parseInt(cantidadPersonas),maximo)}var total=precio*cantidad;vajillasSeleccionadas.push({tipoVajilla:valor,cantidad:cantidad,precio:precio,total:total});precioTotal+=total}});pdf.autoTable({head:[["Tipo de vajilla","Cantidad","Precio x Unidad","TOTAL"]],body:vajillasSeleccionadas.map(function(vajilla){return[vajilla.tipoVajilla,vajilla.cantidad,"$".concat(vajilla.precio.toFixed(2)),"$".concat(vajilla.total.toFixed(2))]}),layout:"lightHorizontalLines",startY:15});var titulo="VajillasREY";var anchoPagina=pdf.internal.pageSize.width;var alturaTitulo=16;var posicionXTitulo=anchoPagina/2-pdf.getStringUnitWidth(titulo)*alturaTitulo/6;pdf.setFontSize(16);pdf.text(titulo,posicionXTitulo,10);var numeroDocumento=document.getElementById("numeroDocumento").value;var anchoDisponible=pdf.internal.pageSize.width- -150;var texto="Este documento certifica que los elementos seleccionados fueron elegidos por el cliente y tienen un precio total de $"+precioTotal.toFixed(2)+". No incluye el seguro, que es opcional con un costo de $5.000, \xe9ste se devolver\xe1 al remitente ya sea por transferencia bancaria CBU, CVU o pago f\xedsico) "+"una vez finalizado el evento y verificado el estado de la vajilla."+"En caso de rotura, se deber\xe1 abonar el elemento da\xf1ado al precio de lista, consulte los precios de reposici\xf3n en la p\xe1gina. "+"El m\xe1ximo a alquilar son 106 platos, 106 copas, 106 cuchillos y 106 tenedores, en caso de que algo se pierda o rompa durante el evento "+"tendr\xe1n 1-2 repuestos dependiendo del stock del momento. Por ejemplo, son 106 personas pero a una se le rompe un plato, habr\xe1n 2 platos "+"adicionales disponibles para usar de emergencia (Esto depende del stock disponible, la cantidad var\xeda de 1 a 2). Esto mismo aplica a cuchillos, tenedores, copas. No aplicable en hieleras, Pinza de hielo, "+"Panera, Legumbrera y Fuente Oval."+"0- \xbfPuedo cancelar mi alquiler? Puede cancelar el alquiler hasta 2 d\xedas antes del evento."+"1- \xbfQu\xe9 hacer una vez tengo mi cotizaci\xf3n? Debes comunicarte por algunas de las v\xedas disponibles; le pediremos en qu\xe9 fecha quiere la vajilla y seg\xfan "+"la disponibilidad te daremos un cup\xf3n para pagar de MercadoPago o pago f\xedsico."+"2- \xbfDebo entregar la vajilla limpia? La vajilla se entregar\xe1 limpia y en sus respectivas cajones de madera."+"3- \xbfQu\xe9 pasa si en alguna copa hay rajaduras o astillamiento? Queda pendiente de evaluaci\xf3n, depende si es una copa y el grado de astillamiento. "+"En caso de los platos depende en qu\xe9 sitio f\xedsicamente suceda; normalmente, si est\xe1 rajado en la parte superior se considera roto debido a "+"qu\xe9 es inseguro volverlo a usar en otros eventos."+"4- \xbfQu\xe9 sucede si falta alg\xfan elemento o m\xe1s y supera el monto del seguro? Si se entregan 100 elementos, deben devolverse 100 elementos. "+"En caso de haya una faltante se descontar\xe1 del seguro ($5.000), en caso de que el monto supere al seguro se puede pagar voluntariamente o se recurrir\xe1 "+"a medidas legales. El cliente con documento ("+numeroDocumento+") firma y est\xe1 conforme con las reglas estipuladas en el contrato.";var textoDividido=pdf.splitTextToSize(texto,anchoDisponible);var fontSize=8;pdf.setFontSize(fontSize);pdf.setTextColor(0,0,0);var positionY=pdf.autoTable.previous.finalY+5;textoDividido.forEach(function(linea){pdf.text(linea,15,positionY);positionY+=pdf.getTextDimensions(linea).h*fontSize/pdf.internal.scaleFactor});positionY+=0;var firmaContainer=document.createElement("div");firmaContainer.id="firma-container";// Cambia a un ID único
firmaContainer.style.width=50+"px";firmaContainer.style.height="180px";firmaContainer.style.borderBottom="1px solid #000";firmaContainer.style.borderRadius="10px";firmaContainer.style.marginTop="5px";html2canvas(document.getElementById("firma-container")).then(function(canvas){var imgData=canvas.toDataURL("image/png");pdf.addImage(imgData,"PNG",15,positionY+3,70,30);pdf.setFontSize(8);pdf.text("Firma del cliente",16,positionY+32);pdf.save("alquiler-vajillas.pdf")})}